# 공유 스토리지(shared storage)
### hostPath의 치명적인 한계
#### 그렇지만 꼭 hostPath를 쓰지 않아야 하는 건 아니다 ! 다만 공식 docs에도 소개가 되었듯이 권장하지는 않는다고 한다.
| 문제점       | 설명                                                         |
| --------- | ---------------------------------------------------------- |
| 노드 종속성  | Pod가 **다른 노드로 이동하면 데이터 없음**<br>(스케줄러가 같은 노드에 붙지 않으면 문제 발생) |
| 확장성 없음  | 다중 노드에서 동일한 데이터 접근 불가                                      |
| 고가용성 불가 | 노드 장애 → 데이터 접근 불가                                          |
| 관리 어려움  | 디스크 사용량, 백업, 권한 등 수동 관리 필요                                 |

### <br/>

### 하지만 모든 걸 공유 스토리지로 해결하려고 하면 안 된다.
#### 스토리지도 역할에 따라 분리해서 최적화하는 게 정답이다.
#### 오히려 무조건 Ceph이나 NFS 같은 공유 스토리지를 강제로 도입하면:
- 성능 저하
- 장애 발생 시 전체 영향
- 복잡도 급증
### <br/>

### 서비스 규모 확장 시 판단 기준
#### 1. DB 노드가 여러 개로 늘어난 경우
#### ✅ DB는 공유 스토리지보다 복제와 백업 전략이 핵심이다.
| 목적                      | 권장 방식                         | 공유 스토리지 필요 여부 |
| ----------------------- | ----------------------------- | ------------- |
| 읽기 부하 분산 (Read Scaling) | Master-Slave (복제)             | ❌ 없음          |
| 고가용성 (Failover)         | MHA, Orchestrator, ProxySQL 등 | ❌ 없음          |
| 동기화 백업                  | 백업용 볼륨만 공유 (예: NFS, S3)       | ⭕ 조건부         |

#### <br/>

#### 2. 백엔드 앱 노드가 수평 확장될 경우
| 목적        | 권장 방식                              | 공유 스토리지 필요 여부 |
| --------- | ---------------------------------- | ------------- |
| 정적 파일 공유  | CephFS, NFS, PVC (RWX)             | ⭕ 필요 가능성 있음   |
| 로그 저장     | 각 노드 로컬 + 로그 수집기 (Fluentd, Loki 등) | ❌ 없음          |
| 파일 업로드 처리 | S3/MinIO 저장소에 업로드                  | ❌ 없음          |

#### <br/>

#### 3. 분석/AI/ML 서버 확장
#### ✅ 이 경우는 공유 스토리지를 도입하는 게 오히려 맞는 방향
| 목적        | 권장 방식                       | 공유 스토리지 필요 여부 |
| --------- | --------------------------- | ------------- |
| 학습 데이터 공유 | CephFS, NFS, Object Storage | ⭕ 필수          |
| 결과 공유     | S3, Ceph RGW, PVC           | ⭕ 필수 가능성 높음   |

### <br/>

### 결론
- 모든 노드를 하나의 스토리지로 묶을 필요는 없음
- 서비스가 커질수록, 성격에 맞는 스토리지를 따로 쓰는 게 더 효율적
- 공유 스토리지는 일부 워크로드(정적파일, 분석 데이터)에만 국한시켜도 됨
