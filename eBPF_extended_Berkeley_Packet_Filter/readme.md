### 250701
## BPF (Berkeley Packet Filter)
### BPF는 1992년, 미국 UC Berkeley에서 만들어졌다.
### 원래 목적은:
- 리눅스 커널 안에서 네트워크 패킷을 빠르게 필터링해서
- tcpdump 같은 툴이 원하는 패킷만 캡처할 수 있게 하려는 것.
### 아주 단순한 패킷 필터용 가상 머신이었다.
### 예:
- "포트 80으로 가는 패킷만 보여줘"
- → BPF가 커널 수준에서 필터링해서 결과만 유저에게 보여줌
### <br/>

## eBPF란?
### **eBPF (extended Berkeley Packet Filter)** 는 **리눅스 커널 안에서 작은 프로그램을 안전하게 실행**할 수 있게 해주는 기술
### 즉, '리눅스 커널을 수정하지 않고', '실시간으로 네트워크, 보안, 트레이싱 등의 기능을 확장'할 수 있게 해주는 "미니 가상 머신"이라고 보면 된다.
### <br/>

### 기존에는 네트워크 정책 등을 적용하려면 iptables(커널 수준 규칙)을 써야 했다.
#### 하지만 iptables는 느리고 복잡함
#### → `eBPF`는 **네트워크 패킷을 커널 안에서 실시간으로 가로채고**, 아주 빠르게 처리할 수 있음
### <br/>

### 확장된 버전: eBPF (extended BPF)
#### 리눅스 개발자들이 이 BPF를 보다가 “어라? 이거 다른 데도 쓰면 좋겠는데?” 라고 생각했다.
#### 그래서 BPF에 다음 기능을 추가했다.
| 확장된 기능       | 설명                                |
| ------------ | --------------------------------- |
| 사용자 정의 로직 실행 | 단순 필터링 외에 복잡한 로직 처리 가능            |
| 여러 위치에 삽입 가능 | 네트워크, 보안, 시스템 콜, 파일 I/O 등         |
| 안전성 검증       | 실행 전에 커널이 eBPF 프로그램을 분석해서 안전한지 체크 |
| 맵(Map) 지원    | 유저와 커널 간 실시간 데이터 교환 가능            |
#### ✅ 그래서 이름이 **“확장된 BPF → eBPF (extended Berkeley Packet Filter)”**가 된 것이다.
### <br/>

### '여러 위치에 삽입 가능'이란?
#### eBPF는 네트워크 패킷뿐 아니라, 리눅스 커널 내부의 다양한 지점(Hook Point)에 붙여서 커널의 동작을 가로채고, 거기서 사용자 정의 로직을 실행할 수 있다는 뜻이다.
#### <br/>

### eBPF가 삽입 가능한 대표적인 위치 (Hook Point)
| 위치                 | 설명                           | eBPF로 할 수 있는 일        |
| ------------------ | ---------------------------- | --------------------- |
| **네트워크 계층**        | 패킷이 들어오거나 나가기 전              | 방화벽, 트래픽 모니터링, L7 필터링 |
| **시스템 콜(syscall)** | `open()`, `execve()` 등 호출될 때 | 파일 접근 차단, 프로세스 추적     |
| **파일 I/O**         | read/write 시점                | 데이터 조작, 로그 기록         |
| **프로세스 이벤트**       | 프로세스 생성/종료                   | 행위 분석, 보안 경고          |
| **트레이싱 계층**        | 함수 진입/종료 지점                  | 성능 측정, 호출 추적          |
| **TCP 연결 상태 변화**   | 연결 생성/종료 시점                  | 상태 기반 제어, 로깅          |

### <br/>

### 예시 흐름
```
유저 -> open("secret.txt")
           ↓
    [ eBPF: 이 파일 접근 기록하자! ]
           ↓
      커널 open 처리 → 파일 열림
```
### <br/>

### 요약
#### eBPF는 원래 tcpdump용 필터(BPF)를 확장해서, 리눅스 커널 안에서 코드까지 실행할 수 있게 만든 기술
### <br/><br/>

## 🔧 무엇을 할 수 있나?
- 네트워크 트래픽 필터링 (→ Cilium이 이걸 함)
- 시스템 콜 감시 (→ 보안 도구에서 사용됨)
- 성능 분석 (→ `bcc`, `bpftrace` 도구 사용)
- 패킷 라우팅, 로드밸런싱
### <br/>

### 🚀 장점

| 항목                   | 설명                              |
| -------------------- | ------------------------------- |
| 🔥 빠름                | 커널 레벨에서 동작 → user-space보다 수배 빠름 |
| 🔒 안전함               | 커널이 실행 전 검증 → 시스템 안정성 유지        |
| 🎯 유연함               | 런타임에 실시간 로직 수정 가능               |
| 🧩 iptables 없이 정책 적용 | 특히 Kubernetes 네트워크에 적합          |

### <br/>

### 📦 Kubernetes에서의 사용 (예: Cilium)
- eBPF를 통해 **Pod 간 트래픽을 빠르고 정확하게 제어**
- HTTP, gRPC 요청 단위로도 제어 가능 (Layer 7)
- iptables보다 빠르고 충돌 없음
### <br/>

### 요약
- **eBPF는 리눅스 커널 안에서 코드를 실시간으로 실행할 수 있게 해주는 기술**
- **네트워크 보안, 모니터링, 성능 향상 등에 혁신적인 도구**
